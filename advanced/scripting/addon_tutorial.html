<!DOCTYPE html>
<html class="writer-html5" lang="zh-hans" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>插件教程 &mdash; Blender Manual</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme_overrides.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/version_switch.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="canonical" href="https://docs.blender.org/manual/en/latest/advanced/scripting/addon_tutorial.html" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script src="../../_static/js/version_switch.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Blender Manual"
          href="../../_static/opensearch.xml"/>
<link rel="alternate" hreflang="en" href="https://docs.blender.org/manual/en/latest/" />
<link rel="alternate" hreflang="ar" href="https://docs.blender.org/manual/ar/latest/" />
<link rel="alternate" hreflang="de" href="https://docs.blender.org/manual/de/latest/" />
<link rel="alternate" hreflang="es" href="https://docs.blender.org/manual/es/latest/" />
<link rel="alternate" hreflang="fi" href="https://docs.blender.org/manual/fi/latest/" />
<link rel="alternate" hreflang="fr" href="https://docs.blender.org/manual/fr/latest/" />
<link rel="alternate" hreflang="id" href="https://docs.blender.org/manual/id/latest/" />
<link rel="alternate" hreflang="it" href="https://docs.blender.org/manual/it/latest/" />
<link rel="alternate" hreflang="ja" href="https://docs.blender.org/manual/ja/latest/" />
<link rel="alternate" hreflang="ko" href="https://docs.blender.org/manual/ko/latest/" />
<link rel="alternate" hreflang="nb" href="https://docs.blender.org/manual/nb/latest/" />
<link rel="alternate" hreflang="pt" href="https://docs.blender.org/manual/pt/latest/" />
<link rel="alternate" hreflang="ru" href="https://docs.blender.org/manual/ru/latest/" />
<link rel="alternate" hreflang="sk" href="https://docs.blender.org/manual/sk/latest/" />
<link rel="alternate" hreflang="sl" href="https://docs.blender.org/manual/sl/latest/" />
<link rel="alternate" hreflang="sr" href="https://docs.blender.org/manual/sr/latest/" />
<link rel="alternate" hreflang="uk" href="https://docs.blender.org/manual/uk/latest/" />
<link rel="alternate" hreflang="vi" href="https://docs.blender.org/manual/vi/latest/" />
<link rel="alternate" hreflang="zh-Hans" href="https://docs.blender.org/manual/zh-hans/latest/" />
<link rel="alternate" hreflang="zh-Hant" href="https://docs.blender.org/manual/zh-hant/latest/" />
<link rel="alternate" hreflang="x-default" href="https://docs.blender.org/manual/en/latest/" />

    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="应用模板" href="../app_templates.html" />
    <link rel="prev" title="脚本与安全" href="security.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Blender 3.6 Manual
              <img src="../../_static/blender-logo.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">入门</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/about/index.html">关于 Blender</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/installing/index.html">安装 Blender</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/configuration/index.html">配置 Blender</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/help.html">帮助系统</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">章节</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../interface/index.html">用户界面</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../editors/index.html">编辑器</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scene_layout/index.html">场景 &amp; 物体</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modeling/index.html">建模</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sculpt_paint/index.html">雕刻 &amp; 绘制</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../grease_pencil/index.html">蜡笔</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../animation/index.html">动画 &amp; 绑定</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../physics/index.html">物理</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../render/index.html">渲染</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../compositing/index.html">合成</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../movie_clip/index.html">运动追踪 &amp; 遮罩</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../video_editing/index.html">视频编辑</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../files/index.html">资产、文件 &amp; 数据系统</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../addons/index.html">插件</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">高级</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../command_line/index.html">命令行</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">脚本与扩展 Blender</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="introduction.html">简介</a></li>
<li class="toctree-l3"><a class="reference internal" href="security.html">脚本与安全</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">插件教程</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#intended-audience">目标读者</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#prerequisites">前提</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#documentation-links">文档链接</a></li>
<li class="toctree-l4"><a class="reference internal" href="#what-is-an-add-on">何为插件？</a></li>
<li class="toctree-l4"><a class="reference internal" href="#your-first-add-on">第一个插件</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#write-the-script">写脚本</a></li>
<li class="toctree-l5"><a class="reference internal" href="#write-the-add-on-simple">写插件 (简易)</a></li>
<li class="toctree-l5"><a class="reference internal" href="#install-the-add-on">安装插件</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#your-second-add-on">第二个插件</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#id1">写脚本</a></li>
<li class="toctree-l5"><a class="reference internal" href="#write-the-add-on">写插件</a><ul>
<li class="toctree-l6"><a class="reference internal" href="#operator-property">操作属性</a></li>
<li class="toctree-l6"><a class="reference internal" href="#menu-item">菜单选项</a></li>
<li class="toctree-l6"><a class="reference internal" href="#keymap">键位映射</a></li>
<li class="toctree-l6"><a class="reference internal" href="#bringing-it-all-together">合二为一</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#conclusions">结语</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#further-reading">扩展阅读</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../app_templates.html">应用模板</a></li>
<li class="toctree-l2"><a class="reference internal" href="../keymap_editing.html">键位映射自定义</a></li>
<li class="toctree-l2"><a class="reference internal" href="../limits.html">功能局限</a></li>
<li class="toctree-l2"><a class="reference internal" href="../operators.html">操作项</a></li>
<li class="toctree-l2"><a class="reference internal" href="../blender_directory_layout.html">Blender 目录布局</a></li>
<li class="toctree-l2"><a class="reference internal" href="../appendices/index.html">附录</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../troubleshooting/index.html">问题排查</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary/index.html">词汇表</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../genindex.html">手册索引</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">参与</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contribute/index.html">贡献文档</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Blender 3.6 Manual</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">高级</a></li>
          <li class="breadcrumb-item"><a href="index.html">脚本与扩展 Blender</a></li>
      <li class="breadcrumb-item active">插件教程</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="add-on-tutorial">
<h1>插件教程<a class="headerlink" href="#add-on-tutorial" title="Permalink to this heading"></a></h1>
<section id="intended-audience">
<h2>目标读者<a class="headerlink" href="#intended-audience" title="Permalink to this heading"></a></h2>
<p>本篇教程旨在帮助技术型艺术家或者开发者学习如何扩展 Blender。对于通读全文的读者，需要通晓 Python 的基础知识。</p>
<section id="prerequisites">
<h3>前提<a class="headerlink" href="#prerequisites" title="Permalink to this heading"></a></h3>
<p>阅读本教程前，用户需要...</p>
<ul class="simple">
<li><p>熟悉 Blender 中的基础功能。</p></li>
<li><p>知道如何在 Blender 的文本编辑器中运行脚本。</p></li>
<li><p>了解 Python 基元类型（整数、布尔值、字符串、列表、元组、字典和集合）。</p></li>
<li><p>熟悉 Python 模块的概念。</p></li>
<li><p>对 Python 中的类（面向对象）有基础认知。</p></li>
</ul>
<p>学习本教程前建议阅读。</p>
<ul class="simple">
<li><p><a class="reference external" href="https://finderiko.com/python-book">Dive Into Python</a> 章节（1、2、3、4 和 7）。</p></li>
<li><p><a class="reference external" href="https://docs.blender.org/api/current/info_quickstart.html">Blender API 快速入门</a>，帮助熟悉 Blender/Python 基础知识。</p></li>
</ul>
<p>为了最好地解决 Python 在编写脚本时打印的任何错误消息，请从终端运行 Blender。请参阅<a class="reference external" href="https://docs.blender.org/api/current/info_tips_and_tricks.html#use-the-terminal">使用终端</a>。</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>您可以在偏好设置中启用<a class="reference internal" href="../../editors/preferences/interface.html#prefs-interface-dev-extras"><span class="std std-ref">开发选项</span></a>以启用使插件开发更容易的功能。</p>
</div>
</section>
</section>
<section id="documentation-links">
<h2>文档链接<a class="headerlink" href="#documentation-links" title="Permalink to this heading"></a></h2>
<p>在阅读教程时，用户可能需要查找参考文档。</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.blender.org/api/current/info_overview.html">Blender API 概述</a>：这份文件相当详细，但如果你想了解更多关于某个主题的信息，还是很有帮助的。</p></li>
<li><p><a class="reference external" href="https://docs.blender.org/api/3.6/bpy.context.html#module-bpy.context" title="(in Blender 3.6.20 Python API v3.6)"><code class="docutils literal notranslate"><span class="pre">bpy.context</span></code></a> API 参考 -- 可以方便地获得脚本可以调用的选项。</p></li>
<li><p><a class="reference external" href="https://docs.blender.org/api/3.6/bpy.types.Operator.html#bpy.types.Operator" title="(in Blender 3.6.20 Python API v3.6)"><code class="docutils literal notranslate"><span class="pre">bpy.types.Operator</span></code></a> -- 下文的插件会定义操作，这些文档提供了更多操作的范例和细节。</p></li>
</ul>
</section>
<section id="what-is-an-add-on">
<h2>何为插件？<a class="headerlink" href="#what-is-an-add-on" title="Permalink to this heading"></a></h2>
<p>插件是附加一些额外要求的 Python 模块，这样 Blender 可以列表形式显示有用信息。</p>
<p>下面的例子是一个最简单的插件:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">bl_info</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;My Test Add-on&quot;</span><span class="p">,</span>
    <span class="s2">&quot;blender&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;Object&quot;</span><span class="p">,</span>
<span class="p">}</span>
<span class="k">def</span> <span class="nf">register</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Hello World&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">unregister</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Goodbye World&quot;</span><span class="p">)</span>
</pre></div>
</div>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">bl_info</span></code></dt><dd><p>一个字典，包含插件元数据如标题、版本和作者，这些信息会显示在用户设置的插件列表。它还指定了运行该脚本的最低版本要求；更老的版本无法在插件列表中显示该插件。</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">register</span></code></dt><dd><p>仅在启用插件时运行的函数，这意味着无需激活插件即可加载模块。</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unregister</span></code></dt><dd><p>用于卸载 <code class="docutils literal notranslate"><span class="pre">register</span></code> 建立的数据的函数，在禁用插件时调用。</p>
</dd>
</dl>
<p>注意：该插件不会进行任何 Blender 相关操作（比如不会载入 <code class="xref py py-mod docutils literal notranslate"><span class="pre">blender_api:bpy</span></code> 模块）。</p>
<p>这是一个刻意设计的插件示例，用于说明插件的基础要求其实很简单。</p>
<p>插件通常会注册操作、面板、菜单选项等，不过这没有多大价值，从文本编辑器，甚至交互控制台执行的脚本也可以做到 -- 插件与 Blender 的结合方式并没有本质上的不同，这些功能都是 <code class="xref py py-mod docutils literal notranslate"><span class="pre">blender_api:bpy</span></code> 模块提供的，任何脚本都可以访问。</p>
<p>所以，插件仅仅是一种封装 Python 模块的方法，以方便用户使用。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>在文本编辑器运行这个脚本不会有任何输出，必须通过用户设置安装该脚本才能看到输出。启用和禁用时均会打印提示信息。</p>
</div>
</section>
<section id="your-first-add-on">
<h2>第一个插件<a class="headerlink" href="#your-first-add-on" title="Permalink to this heading"></a></h2>
<p>上文中的最简插件除举例外别无它用。下面的插件也很简单，不过演示了如何使用一个 <code class="docutils literal notranslate"><span class="pre">Operator</span></code> 将脚本集成到Blender，<code class="docutils literal notranslate"><span class="pre">Operator</span></code> 是用于定义可从菜单、按钮和快捷键访问的工具的特有方法。</p>
<p>首先，写一个移动场景内所有物体的脚本。</p>
<section id="write-the-script">
<h3>写脚本<a class="headerlink" href="#write-the-script" title="Permalink to this heading"></a></h3>
<p>在文本编辑器添加下面的脚本:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">bpy</span>

<span class="n">scene</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span>
<span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">scene</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="mf">1.0</span>
</pre></div>
</div>
<p>按下<a class="reference internal" href="../../editors/text_editor.html#editors-text-run-script"><span class="std std-ref">运行脚本按钮</span></a>，活动场景内的所有物体均会移动 1 个 Blender 单位。</p>
</section>
<section id="write-the-add-on-simple">
<span id="advanced-scripting-write-the-add-on-simple"></span><h3>写插件 (简易)<a class="headerlink" href="#write-the-add-on-simple" title="Permalink to this heading"></a></h3>
<p>这个插件使用了上面的脚本，并将其添加到一个 operator 的 <code class="docutils literal notranslate"><span class="pre">execute()</span></code> 函数中:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">bl_info</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Move X Axis&quot;</span><span class="p">,</span>
    <span class="s2">&quot;blender&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;Object&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="kn">import</span> <span class="nn">bpy</span>


<span class="k">class</span> <span class="nc">ObjectMoveX</span><span class="p">(</span><span class="n">bpy</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">Operator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;My Object Moving Script&quot;&quot;&quot;</span>      <span class="c1"># Use this as a tooltip for menu items and buttons.</span>
    <span class="n">bl_idname</span> <span class="o">=</span> <span class="s2">&quot;object.move_x&quot;</span>        <span class="c1"># Unique identifier for buttons and menu items to reference.</span>
    <span class="n">bl_label</span> <span class="o">=</span> <span class="s2">&quot;Move X by One&quot;</span>         <span class="c1"># Display name in the interface.</span>
    <span class="n">bl_options</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;REGISTER&#39;</span><span class="p">,</span> <span class="s1">&#39;UNDO&#39;</span><span class="p">}</span>  <span class="c1"># Enable undo for the operator.</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>        <span class="c1"># execute() is called when running the operator.</span>

        <span class="c1"># The original script</span>
        <span class="n">scene</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">scene</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">scene</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="mf">1.0</span>

        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;FINISHED&#39;</span><span class="p">}</span>            <span class="c1"># Lets Blender know the operator finished successfully.</span>

<span class="k">def</span> <span class="nf">menu_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">operator</span><span class="p">(</span><span class="n">ObjectMoveX</span><span class="o">.</span><span class="n">bl_idname</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">register</span><span class="p">():</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">register_class</span><span class="p">(</span><span class="n">ObjectMoveX</span><span class="p">)</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">VIEW3D_MT_object</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">menu_func</span><span class="p">)</span>  <span class="c1"># Adds the new operator to an existing menu.</span>

<span class="k">def</span> <span class="nf">unregister</span><span class="p">():</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">unregister_class</span><span class="p">(</span><span class="n">ObjectMoveX</span><span class="p">)</span>


<span class="c1"># This allows you to run the script directly from Blender&#39;s Text editor</span>
<span class="c1"># to test the add-on without having to install it.</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">register</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">bl_info</span></code> 被分割成多行，这仅仅是一种编程风格，可以方便添加元素。</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>这里传递给 <code class="docutils literal notranslate"><span class="pre">execute()</span></code> 的参数是 <code class="docutils literal notranslate"><span class="pre">context.scene</span></code>，而非 <code class="docutils literal notranslate"><span class="pre">bpy.context.scene</span></code>。大多数情况下，两者是一致的。然而在一些情况下，传递给 operators 的是自定义 context，所以脚本作者更愿意传递 <code class="docutils literal notranslate"><span class="pre">context</span></code> 参数至 operator。</p>
</div>
<p>要测试这段脚本，你可以将其复制粘贴到 Blender 文本编辑器，并运行。这将直接执行脚本，并立即调用 register 函数。</p>
<p>不过，运行该脚本不能直接移动物体。你需要执行新注册的 operator 。</p>
<figure class="align-default" id="id2">
<img alt="../../_images/advanced_scripting_addon-tutorial_operator-search-menu.png" src="../../_images/advanced_scripting_addon-tutorial_operator-search-menu.png" />
<figcaption>
<p><span class="caption-text">操作符搜索菜单。</span><a class="headerlink" href="#id2" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>打开<a class="reference internal" href="../../interface/controls/templates/operator_search.html#bpy-ops-wm-search-operator"><span class="std std-ref">操作符搜索</span></a>菜单并键入 &quot;Move X by One&quot;（<code class="docutils literal notranslate"><span class="pre">bl_label</span></code>），然后按 <kbd class="kbd docutils literal notranslate">回车</kbd>。</p>
<p>物体将与前文一样移动。</p>
<p><em>不要关闭文本编辑器，下一步安装需要用到</em></p>
</section>
<section id="install-the-add-on">
<h3>安装插件<a class="headerlink" href="#install-the-add-on" title="Permalink to this heading"></a></h3>
<p>在 Blender 文本编辑器写好插件后，你可能想要安装该插件，这样就可以在用户设置中启用启动时加载插件。</p>
<p>尽管上面的插件只是一个测试，但还是把这些步骤都走一遍，这样以后就知道该怎么做了。</p>
<p>要安装 Blender 文本编辑器里写的插件，首先需要存盘，注意遵守 Python 模块的命名限制，并以 <code class="docutils literal notranslate"><span class="pre">.py</span></code> 作为扩展名。</p>
<p>存盘之后，就可以跟从网上下载的插件一样安装了。</p>
<p>打开 <span class="menuselection">偏好设置 ‣ 插件 ‣ 安装...</span>，并选择该文件。</p>
<p>现在将列出该插件，您可以通过按复选框来启用它，如果您希望在重新启动时启用它，请按 <em>另存为默认值</em>。该运算符的运行方式与<a class="reference internal" href="#advanced-scripting-write-the-add-on-simple"><span class="std std-ref">上一节</span></a>中所述的方式相同。</p>
<p>启用插件后，Blender 将执行代码并运行 <code class="docutils literal notranslate"><span class="pre">register()</span></code> 函数。禁用插件后，Blender 则运行 <code class="docutils literal notranslate"><span class="pre">unregister()</span></code> 函数。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>插件的安装位置取决于你的 Blender 配置。安装插件时，控制台会提示插件的原始和目标路径。在 Python 控制台运行下面的脚本，也可以查找插件目标路径:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">addon_utils</span>
<span class="nb">print</span><span class="p">(</span><span class="n">addon_utils</span><span class="o">.</span><span class="n">paths</span><span class="p">())</span>
</pre></div>
</div>
<p>更多这方面内容见：<a class="reference internal" href="../blender_directory_layout.html#blender-directory-layout"><span class="std std-ref">目录布局</span></a>。</p>
</div>
</section>
</section>
<section id="your-second-add-on">
<h2>第二个插件<a class="headerlink" href="#your-second-add-on" title="Permalink to this heading"></a></h2>
<p>第二个插件是关于物体实例化 -- 亦即 -- 以与阵列修改器类似的方法生成物体的关联副本。</p>
<section id="id1">
<h3>写脚本<a class="headerlink" href="#id1" title="Permalink to this heading"></a></h3>
<p>和前面一样，我们从一段脚本开始，然后将其转化为插件:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">bpy</span>
<span class="kn">from</span> <span class="nn">bpy</span> <span class="kn">import</span> <span class="n">context</span>

<span class="c1"># Get the current scene</span>
<span class="n">scene</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">scene</span>

<span class="c1"># Get the 3D cursor location</span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">scene</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">location</span>

<span class="c1"># Get the active object (assume we have one)</span>
<span class="n">obj</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">active_object</span>

<span class="c1"># Now make a copy of the object</span>
<span class="n">obj_new</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># The new object has to be added to a collection in the scene</span>
<span class="n">scene</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">obj_new</span><span class="p">)</span>

<span class="c1"># Now we can place the object</span>
<span class="n">obj_new</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">cursor</span>
</pre></div>
</div>
<p>现在，把这段脚本复制到 Blender 文本编辑器，选择立方体并运行脚本。运行脚本前记得单击将 3D 游标移动一旁，副本物体将出现在游标位置。</p>
<p>运行过后，进入 <em>编辑模式</em> 修改立方体后 -- 所有的副本会同时变化，这在 Blender 里称作 <em>关联副本</em>。</p>
<p>下一步，把这段脚本加到循环里，在活动物体与游标之间生成物体阵列:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">bpy</span>
<span class="kn">from</span> <span class="nn">bpy</span> <span class="kn">import</span> <span class="n">context</span>

<span class="n">scene</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">scene</span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">scene</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">location</span>
<span class="n">obj</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">active_object</span>

<span class="c1"># Use a fixed value for now, eventually make this user adjustable</span>
<span class="n">total</span> <span class="o">=</span> <span class="mi">10</span>

<span class="c1"># Add &#39;total&#39; objects into the scene</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">total</span><span class="p">):</span>
    <span class="n">obj_new</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">scene</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">obj_new</span><span class="p">)</span>

    <span class="c1"># Now place the object in between the cursor</span>
    <span class="c1"># and the active object based on &#39;i&#39;</span>
    <span class="n">factor</span> <span class="o">=</span> <span class="n">i</span> <span class="o">/</span> <span class="n">total</span>
    <span class="n">obj_new</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">location</span> <span class="o">*</span> <span class="n">factor</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">cursor</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">factor</span><span class="p">))</span>
</pre></div>
</div>
<p>将 3D 游标远离活动物体，运行脚本，查看结果。</p>
<p>在这段脚本里，对物体和游标位置做了一点数学运算，这是因为两者都是 3D <a class="reference external" href="https://docs.blender.org/api/3.6/mathutils.html#mathutils.Vector" title="(in Blender 3.6.20 Python API v3.6)"><code class="docutils literal notranslate"><span class="pre">mathutils.Vector</span></code></a> 实例，<a class="reference external" href="https://docs.blender.org/api/3.6/mathutils.html#module-mathutils" title="(in Blender 3.6.20 Python API v3.6)"><code class="docutils literal notranslate"><span class="pre">mathutils</span></code></a> 模块提供了这个方便的类，并且允许向量与数值和矩阵做乘法运算。</p>
<p>如果你对这方面感兴趣的话，可以进一步阅读 <a class="reference external" href="https://docs.blender.org/api/3.6/mathutils.html#mathutils.Vector" title="(in Blender 3.6.20 Python API v3.6)"><code class="docutils literal notranslate"><span class="pre">mathutils.Vector</span></code></a> -- 这里有很多方便的工具函数如计算向量夹角、叉乘、点乘，<a class="reference external" href="https://docs.blender.org/api/3.6/mathutils.geometry.html#module-mathutils.geometry" title="(in Blender 3.6.20 Python API v3.6)"><code class="docutils literal notranslate"><span class="pre">mathutils.geometry</span></code></a> 还提供了更高级的函数如 Bézier 样条曲线插值和射线-三角形相交。</p>
<p>现在我们专心将这段脚本编程插件，不过知道这个 3D 数学模块也是不错的，以后更高级的功能可能用到它。</p>
</section>
<section id="write-the-add-on">
<h3>写插件<a class="headerlink" href="#write-the-add-on" title="Permalink to this heading"></a></h3>
<p>首先将脚本转换为插件:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">bl_info</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Cursor Array&quot;</span><span class="p">,</span>
    <span class="s2">&quot;blender&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;Object&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="kn">import</span> <span class="nn">bpy</span>


<span class="k">class</span> <span class="nc">ObjectCursorArray</span><span class="p">(</span><span class="n">bpy</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">Operator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Object Cursor Array&quot;&quot;&quot;</span>
    <span class="n">bl_idname</span> <span class="o">=</span> <span class="s2">&quot;object.cursor_array&quot;</span>
    <span class="n">bl_label</span> <span class="o">=</span> <span class="s2">&quot;Cursor Array&quot;</span>
    <span class="n">bl_options</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;REGISTER&#39;</span><span class="p">,</span> <span class="s1">&#39;UNDO&#39;</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="n">scene</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">scene</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">scene</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">location</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">active_object</span>

        <span class="n">total</span> <span class="o">=</span> <span class="mi">10</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">total</span><span class="p">):</span>
            <span class="n">obj_new</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">scene</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">obj_new</span><span class="p">)</span>

            <span class="n">factor</span> <span class="o">=</span> <span class="n">i</span> <span class="o">/</span> <span class="n">total</span>
            <span class="n">obj_new</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">location</span> <span class="o">*</span> <span class="n">factor</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">cursor</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">factor</span><span class="p">))</span>

        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;FINISHED&#39;</span><span class="p">}</span>

<span class="k">def</span> <span class="nf">register</span><span class="p">():</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">register_class</span><span class="p">(</span><span class="n">ObjectCursorArray</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">unregister</span><span class="p">():</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">unregister_class</span><span class="p">(</span><span class="n">ObjectCursorArray</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">register</span><span class="p">()</span>
</pre></div>
</div>
<p>接下来的步骤上文已经介绍过了，不过你还是可以运行脚本，再考虑一下如何改进这插件的功能。</p>
<p>其中两个最明显的缺陷是 -- 总数固定为 10，以及通过<a class="reference internal" href="../../interface/controls/templates/operator_search.html"><span class="doc">搜索</span></a>访问操作符不太方便。</p>
<p>下文将讲解如何改进，并给出最终脚本代码。</p>
<section id="operator-property">
<h4>操作属性<a class="headerlink" href="#operator-property" title="Permalink to this heading"></a></h4>
<p>有多种属性类型可用于工具设置，常见的属性类型包括：整型、浮点型、矢量型、颜色、布尔型和字符串型。</p>
<p>这些属性与 Python 类的属性用法不同，因为 Blender 需要在界面显示、保存其键位映射设置，并保留设置供下次使用。</p>
<p>尽管这是相当 Python 化的方式，但是记住，实际上你定义的工具设置会被加载到 Blender，并被 Blender 的其他部分从 Python 外部访问。</p>
<p>要消除 <code class="docutils literal notranslate"><span class="pre">总数</span></code> 为 10 的问题，会用到一个操作属性。操作属性是通过 bpy.props 模块定义的，将下面的代码加到 operator 类的主体中:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># moved assignment from execute() to the body of the class...</span>
<span class="n">total</span><span class="p">:</span> <span class="n">bpy</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">IntProperty</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Steps&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

<span class="c1"># and this is accessed on the class</span>
<span class="c1"># instance within the execute() function as...</span>
<span class="bp">self</span><span class="o">.</span><span class="n">total</span>
</pre></div>
</div>
<p>这些来自 <a class="reference external" href="https://docs.blender.org/api/3.6/bpy.props.html#module-bpy.props" title="(in Blender 3.6.20 Python API v3.6)"><code class="docutils literal notranslate"><span class="pre">bpy.props</span></code></a> 的属性会被 Blender 特别处理，当（operator）类被注册后，会在界面显示属性按钮。可以传递很多参数给属性，如设置上下界、修改默认值和显示工具提示。</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://docs.blender.org/api/3.6/bpy.props.html#bpy.props.IntProperty" title="(in Blender 3.6.20 Python API v3.6)"><code class="docutils literal notranslate"><span class="pre">bpy.props.IntProperty()</span></code></a></p>
</div>
<p>这篇文档不会详细介绍如何使用其他属性类型，不过上面的链接包含了更高级的属性用法范例。</p>
</section>
<section id="menu-item">
<h4>菜单选项<a class="headerlink" href="#menu-item" title="Permalink to this heading"></a></h4>
<p>插件可以添加到现有的面板、标题栏和菜单等 Python 定义的用户界面中。</p>
<p>这个例子里，我们将其添加到现有菜单。</p>
<figure class="align-default" id="id3">
<img alt="../../_images/advanced_scripting_addon-tutorial_menu-id.png" src="../../_images/advanced_scripting_addon-tutorial_menu-id.png" />
<figcaption>
<p><span class="caption-text">菜单标识符。</span><a class="headerlink" href="#id3" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>先在用户设置中启用 <em>Python工具提示</em>，鼠标在菜单上方停留，会出现提示，就能找到菜单标识符了。</p>
<p>添加菜单选项的方式是，在给现有类追加一个绘制函数:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">menu_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">operator</span><span class="p">(</span><span class="n">ObjectCursorArray</span><span class="o">.</span><span class="n">bl_idname</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">register</span><span class="p">():</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">register_class</span><span class="p">(</span><span class="n">ObjectCursorArray</span><span class="p">)</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">VIEW3D_MT_object</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">menu_func</span><span class="p">)</span>
</pre></div>
</div>
<p>扩展菜单的文档，请参考 <a class="reference external" href="https://docs.blender.org/api/3.6/bpy.types.Menu.html#bpy.types.Menu" title="(in Blender 3.6.20 Python API v3.6)"><code class="docutils literal notranslate"><span class="pre">bpy.types.Menu</span></code></a>。</p>
</section>
<section id="keymap">
<h4>键位映射<a class="headerlink" href="#keymap" title="Permalink to this heading"></a></h4>
<p>在 Blender 中，插件可以有自己的键位映射，以避免与 Blender 内置键位映射冲突。</p>
<p>在下面的例子中，添加了一个新的物体模式 <a class="reference external" href="https://docs.blender.org/api/3.6/bpy.types.KeyMap.html#bpy.types.KeyMap" title="(in Blender 3.6.20 Python API v3.6)"><code class="docutils literal notranslate"><span class="pre">bpy.types.KeyMap</span></code></a>，接着向该键位映射添加了一个 <a class="reference external" href="https://docs.blender.org/api/3.6/bpy.types.KeyMapItem.html#bpy.types.KeyMapItem" title="(in Blender 3.6.20 Python API v3.6)"><code class="docutils literal notranslate"><span class="pre">bpy.types.KeyMapItem</span></code></a>，指向新添加的操作，使用 <kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">Shift</kbd>-<kbd class="kbd docutils literal notranslate">Ctrl</kbd>-<kbd class="kbd docutils literal notranslate">T</kbd></kbd> 作为快捷键:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># store keymaps here to access after registration</span>
<span class="n">addon_keymaps</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">def</span> <span class="nf">register</span><span class="p">():</span>

    <span class="c1"># handle the keymap</span>
    <span class="n">wm</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">window_manager</span>
    <span class="n">km</span> <span class="o">=</span> <span class="n">wm</span><span class="o">.</span><span class="n">keyconfigs</span><span class="o">.</span><span class="n">addon</span><span class="o">.</span><span class="n">keymaps</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Object Mode&#39;</span><span class="p">,</span> <span class="n">space_type</span><span class="o">=</span><span class="s1">&#39;EMPTY&#39;</span><span class="p">)</span>

    <span class="n">kmi</span> <span class="o">=</span> <span class="n">km</span><span class="o">.</span><span class="n">keymap_items</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">ObjectCursorArray</span><span class="o">.</span><span class="n">bl_idname</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39;PRESS&#39;</span><span class="p">,</span> <span class="n">ctrl</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">kmi</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">4</span>

    <span class="n">addon_keymaps</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">km</span><span class="p">,</span> <span class="n">kmi</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">unregister</span><span class="p">():</span>

    <span class="c1"># handle the keymap</span>
    <span class="k">for</span> <span class="n">km</span><span class="p">,</span> <span class="n">kmi</span> <span class="ow">in</span> <span class="n">addon_keymaps</span><span class="p">:</span>
        <span class="n">km</span><span class="o">.</span><span class="n">keymap_items</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">kmi</span><span class="p">)</span>
    <span class="n">addon_keymaps</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</pre></div>
</div>
<p>值得注意的是，键位映射的 <code class="docutils literal notranslate"><span class="pre">total</span></code> 值与 operator 的默认值不同，这样就可以通过不同按键组合访问不同设置的同一 operator 。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>虽然 <kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">Shift</kbd>-<kbd class="kbd docutils literal notranslate">Ctrl</kbd>-<kbd class="kbd docutils literal notranslate">T</kbd></kbd> 不是默认的 Blender 键快捷键，但很难确保插件不会覆盖彼此的键位映射。因此，在分配按键时至少要小心，不能与 Blender 的重要功能冲突（另请参阅 <a class="reference internal" href="../../addons/development/is_key_free.html"><span class="doc">Is Key Free</span></a>）。</p>
</div>
<p>上文所用函数的 API 文档，见：</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.blender.org/api/3.6/bpy.types.KeyMaps.html#bpy.types.KeyMaps.new" title="(in Blender 3.6.20 Python API v3.6)"><code class="docutils literal notranslate"><span class="pre">bpy.types.KeyMaps.new()</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.blender.org/api/3.6/bpy.types.KeyMap.html#bpy.types.KeyMap" title="(in Blender 3.6.20 Python API v3.6)"><code class="docutils literal notranslate"><span class="pre">bpy.types.KeyMap</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.blender.org/api/3.6/bpy.types.KeyMapItems.html#bpy.types.KeyMapItems.new" title="(in Blender 3.6.20 Python API v3.6)"><code class="docutils literal notranslate"><span class="pre">bpy.types.KeyMapItems.new()</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.blender.org/api/3.6/bpy.types.KeyMapItem.html#bpy.types.KeyMapItem" title="(in Blender 3.6.20 Python API v3.6)"><code class="docutils literal notranslate"><span class="pre">bpy.types.KeyMapItem</span></code></a></p></li>
</ul>
</section>
<section id="bringing-it-all-together">
<h4>合二为一<a class="headerlink" href="#bringing-it-all-together" title="Permalink to this heading"></a></h4>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">bl_info</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Cursor Array&quot;</span><span class="p">,</span>
    <span class="s2">&quot;blender&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;Object&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="kn">import</span> <span class="nn">bpy</span>


<span class="k">class</span> <span class="nc">ObjectCursorArray</span><span class="p">(</span><span class="n">bpy</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">Operator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Object Cursor Array&quot;&quot;&quot;</span>
    <span class="n">bl_idname</span> <span class="o">=</span> <span class="s2">&quot;object.cursor_array&quot;</span>
    <span class="n">bl_label</span> <span class="o">=</span> <span class="s2">&quot;Cursor Array&quot;</span>
    <span class="n">bl_options</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;REGISTER&#39;</span><span class="p">,</span> <span class="s1">&#39;UNDO&#39;</span><span class="p">}</span>

    <span class="n">total</span><span class="p">:</span> <span class="n">bpy</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">IntProperty</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Steps&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="n">scene</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">scene</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">scene</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">location</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">active_object</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total</span><span class="p">):</span>
            <span class="n">obj_new</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">scene</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">obj_new</span><span class="p">)</span>

            <span class="n">factor</span> <span class="o">=</span> <span class="n">i</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">total</span>
            <span class="n">obj_new</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">location</span> <span class="o">*</span> <span class="n">factor</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">cursor</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">factor</span><span class="p">))</span>

        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;FINISHED&#39;</span><span class="p">}</span>


<span class="k">def</span> <span class="nf">menu_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">operator</span><span class="p">(</span><span class="n">ObjectCursorArray</span><span class="o">.</span><span class="n">bl_idname</span><span class="p">)</span>

<span class="c1"># store keymaps here to access after registration</span>
<span class="n">addon_keymaps</span> <span class="o">=</span> <span class="p">[]</span>


<span class="k">def</span> <span class="nf">register</span><span class="p">():</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">register_class</span><span class="p">(</span><span class="n">ObjectCursorArray</span><span class="p">)</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">VIEW3D_MT_object</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">menu_func</span><span class="p">)</span>

    <span class="c1"># handle the keymap</span>
    <span class="n">wm</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">window_manager</span>
    <span class="c1"># Note that in background mode (no GUI available), keyconfigs are not available either,</span>
    <span class="c1"># so we have to check this to avoid nasty errors in background case.</span>
    <span class="n">kc</span> <span class="o">=</span> <span class="n">wm</span><span class="o">.</span><span class="n">keyconfigs</span><span class="o">.</span><span class="n">addon</span>
    <span class="k">if</span> <span class="n">kc</span><span class="p">:</span>
        <span class="n">km</span> <span class="o">=</span> <span class="n">wm</span><span class="o">.</span><span class="n">keyconfigs</span><span class="o">.</span><span class="n">addon</span><span class="o">.</span><span class="n">keymaps</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Object Mode&#39;</span><span class="p">,</span> <span class="n">space_type</span><span class="o">=</span><span class="s1">&#39;EMPTY&#39;</span><span class="p">)</span>
        <span class="n">kmi</span> <span class="o">=</span> <span class="n">km</span><span class="o">.</span><span class="n">keymap_items</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">ObjectCursorArray</span><span class="o">.</span><span class="n">bl_idname</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39;PRESS&#39;</span><span class="p">,</span> <span class="n">ctrl</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">kmi</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="n">addon_keymaps</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">km</span><span class="p">,</span> <span class="n">kmi</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">unregister</span><span class="p">():</span>
    <span class="c1"># Note: when unregistering, it&#39;s usually good practice to do it in reverse order you registered.</span>
    <span class="c1"># Can avoid strange issues like keymap still referring to operators already unregistered...</span>
    <span class="c1"># handle the keymap</span>
    <span class="k">for</span> <span class="n">km</span><span class="p">,</span> <span class="n">kmi</span> <span class="ow">in</span> <span class="n">addon_keymaps</span><span class="p">:</span>
        <span class="n">km</span><span class="o">.</span><span class="n">keymap_items</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">kmi</span><span class="p">)</span>
    <span class="n">addon_keymaps</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="n">bpy</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">unregister_class</span><span class="p">(</span><span class="n">ObjectCursorArray</span><span class="p">)</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">VIEW3D_MT_object</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">menu_func</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">register</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default" id="id4">
<img alt="../../_images/advanced_scripting_addon-tutorial_in-menu.png" src="../../_images/advanced_scripting_addon-tutorial_in-menu.png" />
<figcaption>
<p><span class="caption-text">菜单选项。</span><a class="headerlink" href="#id4" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>运行该脚本（或保存后通过用户设置安装），操作会出现在 <em>物体</em> 菜单中。</p>
<figure class="align-default" id="id5">
<img alt="../../_images/advanced_scripting_addon-tutorial_op-prop.png" src="../../_images/advanced_scripting_addon-tutorial_op-prop.png" />
<figcaption>
<p><span class="caption-text">操作属性。</span><a class="headerlink" href="#id5" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>从菜单执行操作后，你还可以选择添加的立方体实例数量。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>多次直接执行脚本也会每次添加菜单。虽然没有有用的行为，但没有什么可担心的，因为当通过偏好设置启用时，插件不会多次注册自己。</p>
</div>
</section>
</section>
</section>
<section id="conclusions">
<h2>结语<a class="headerlink" href="#conclusions" title="Permalink to this heading"></a></h2>
<p>插件可以整洁地封装特定功能，用于编写工具改善工作流，或者编写功能供其他人使用。</p>
<p>尽管 Blender 中 Python 可以做的还存在一些限制，不过已经可以实现相当多的功能，使用户免于钻研 Blender 的 C/C++ 源码。</p>
<p>教程里可以给出的范例始终是有限的，不过已经演示了用于常见任务的 Blender API，用户可以借此延伸出自己的工具。</p>
<section id="further-reading">
<h3>扩展阅读<a class="headerlink" href="#further-reading" title="Permalink to this heading"></a></h3>
<p>Blender 附带了一些注释过的模板，可以在文本编辑器标题栏找到，如果你需要某个方面的示例代码，从这里开始是一个不错的选择。</p>
<p>看完上面的教程过后，这里提供了几个你可能用到的网址。</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.blender.org/api/current/info_overview.html">Blender/Python API 概述</a> -- 关于 Blender/Python 整合的更多背景细节。</p></li>
<li><p><a class="reference external" href="https://runestone.academy/ns/books/published/thinkcspy/index.html">如何像计算机科学家一样思考</a> -- 对于那些仍在学习 Python 的人来说，这是一个很好的信息。</p></li>
<li><p><a class="reference external" href="https://wiki.blender.org">Blender 开发 (Wiki)</a> -- Blender 开发、一般信息和有用链接。</p></li>
<li><p><a class="reference external" href="https://devtalk.blender.org/tag/python">DevTalk</a> -- 人们向 Python 开发提问的论坛。</p></li>
</ul>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="security.html" class="btn btn-neutral float-left" title="脚本与安全" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../app_templates.html" class="btn btn-neutral float-right" title="应用模板" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; <a href="../../copyright.html">Copyright</a> : This page is licensed under a CC-BY-SA 4.0 Int. License.
      <span class="lastupdated">Last updated on 02/14/2025.
      </span></p>
  </div>

  
<div class="footer-contribute">
   <ul>
      <li>
         <a href="https://projects.blender.org/blender/blender-manual/src/branch/main/manual/advanced/scripting/addon_tutorial.rst"
            class="fa fa-edit"> 查看源</a>
      </li>
      <!-- <li>
         <a href="https://projects.blender.org/blender/blender-manual/src/branch/main/manual/advanced/scripting/addon_tutorial.rst"
            class="fa fa-edit"> 编辑页面</a>
      </li> -->
      <li>
         <a href="https://projects.blender.org/blender/documentation/issues/new?template=.gitea/issue_template/bug.yaml&field:body=%2A%2APage+Information%2A%2A%0D%0AFile%3A+%60manual%2Fadvanced/scripting/addon_tutorial.rst%60%0D%0ABlender+Version%3A+%603.6%60%0D%0ADocumentation+Language%3A+%60zh-hans%60%0D%0A%5BPermanent+Link%5D%28https%3A%2F%2Fdocs.blender.org%2Fmanual%2Fzh-hans%2F3.6%2Fadvanced/scripting/addon_tutorial.html%29%0D%0A%0D%0A%2A%2AShort+description+of+error%2A%2A%0D%0A%5BPlease+fill+out+a+short+description+of+the+error+here%5D%0D%0A"
            class="fa fa-bug"> 报告本页面的问题</a>
      </li>
      <ul>
</div>


</footer>
        </div>
      </div>
    </section>
  </div>
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="document versions">
	<ul id="versionwrap" role="presentation">
		<li role="presentation">
			<span id="version-popover" class="version-btn" tabindex="0" role="button" aria-label="versions selector"
				aria-haspopup="true" aria-controls="version-vsnlist" aria-disabled="true">
				3.6
			</span>
			<div class="version-dialog" aria-hidden="true">
				<div class="version-arrow" aria-hidden="true"></div>
				<div class="version-title">Versions</div>
				<ul id="version-vsnlist" class="version-list" role="menu" aria-labelledby="version-popover"
					aria-hidden="true">
					<li role="presentation">Loading...</li>
				</ul>
			</div>
		</li>
		<li role="presentation">
			<span id="lang-popover" class="version-btn" tabindex="0" role="button" aria-label="language selector"
				aria-haspopup="true" aria-controls="version-langlist">
				 zh-hans 
			</span>
			<div class="version-dialog" aria-hidden="true">
				<div class="version-arrow" aria-hidden="true"></div>
				<div class="version-title">Languages</div>
				<ul id="version-langlist" class="version-list" role="menu" aria-labelledby="lang-popover"
					aria-hidden="true">
					<li role="presentation">Loading...</li>
				</ul>
			</div>
		</li>
		<template id="version-entry">
			<li tabindex="-1" role="presentation"><a tabindex="-1" role="menuitem"></a></li>
			<li class="selected" tabindex="-1" role="presentation"><span tabindex="-1" aria-current="page"></spanp></li>
		</template>
	</ul>
<template id="version-warning">
	<div class="admonition warning">
		<p class="first admonition-title">Note</p>
		<p class="last">
			You are not using the most up to date version of the documentation.
			<a href="#"></a> is the newest version.
		</p>
	</div>
</template>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-1418081-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-1418081-1', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>